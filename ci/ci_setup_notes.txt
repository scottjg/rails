# Notes on Rails Continuous Integration Server Setup Notes

* Set up ci user:
# log in as root
$ adduser ci
enter user info and password
$ visudo
# give ci user same sudo rights as root

* Disable root login:
# log in as ci
$ sudo vi /etc/shadow
# overwrite and disable encrypted root password to disable root login:
root:*:14001:0:99999:7:::

* Change Hostname:
$ sudo vi /etc/hostname
change to 'ci'
$ sudo vi /etc/hosts
replace old hostname with 'ci'
# reboot to use new hostname (and test reboot)
$ sudo shutdown -r now

* Update aptitude
$ sudo aptitude update

* Install postfix
$ sudo aptitude install postfix
# pick 'Internet Site'
# type hostname

* Use cinabox to perform rest of ruby/ccrb setup

* (temp until ci files in thewoolleyman branch are checked into rails repo):
  * Check out ci branch w/git to ~/workspace/rails_thewoolleyman: http://github.com/thewoolleyman/rails/tree/ci
  $ ln -s /home/ci/workspace/rails_thewoolleyman/ci/site_config.rb /home/ci/.cruise/site_config.rb
  $ ln -s /home/ci/workspace/rails_thewoolleyman/ci/cruise_config.rb /home/ci/.cruise/projects/rails/cruise_config.rb
  $ ln -s /home/ci/workspace/rails_thewoolleyman/ci/rails_build.rb /home/ci/.cruise/projects/rails/rails_build.rb
  $ ln -s /home/ci/workspace/rails_thewoolleyman/ci/geminstaller.yml /home/ci/.cruise/projects/rails/geminstaller.yml
  $ sudo gem install geminstaller
  $ sudo geminstaller --config /home/ci/.cruise/projects/rails/geminstaller.yml 

* Install build-essential package (to build native gems)
$ sudo aptitude install build-essential

* Set up mysql
$ sudo aptitude install mysql-server-5.0 libmysqlclient-dev
# no password for mysql root user
# add mysql gem to geminstaller.yml
# run 'sudo geminstaller' from dir containing geminstaller.yml

* Create ActiveRecord test databases for mysql
$ mysql -uroot -e 'grant all on *.* to rails@localhost;'
$ mysql -urails -e 'create database activerecord_unittest;'
$ mysql -urails -e 'create database activerecord_unittest2;'

* setup sqlite
$ sudo aptitude install sqlite sqlite3 libsqlite-dev libsqlite3-dev
# add sqlite-ruby/sqlite3-ruby gems to geminstaller, run it

* setup postgres
$ sudo aptitude install postgresql postgresql-server-dev-8.3
# add postgres gem to geminstaller, run it
# cd to activerecord dir
$ sudo su - postgres -c 'createuser -s ci'
$ rake postgresql:build_databases